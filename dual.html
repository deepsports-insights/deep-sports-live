<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>DeepSports ‚Ä¢ Dual</title>
<link rel="stylesheet" href="css/style.css">
</head>
<body class="theme-broadcast">
  <header class="bar top">
    <div class="brand">DeepSports Insights</div>
    <div class="now" id="status">‚Äî</div>
  </header>

  <main class="dual">
    <section class="panel" id="panelL">
      <div class="panel-head">
        <div class="title" id="titleL">Partido A (Canal 1)</div>
        <div class="tags"><span class="tag">Ritmo</span><span class="tag">L√≠nea</span><span class="tag">Proyecci√≥n</span></div>
      </div>
      <div class="feed" id="feedL"></div>
      <div class="swish" id="swishL" aria-hidden="true">üèÄ</div>
    </section>

    <section class="panel" id="panelR">
      <div class="panel-head">
        <div class="title" id="titleR">Partido B (Canal 2)</div>
        <div class="tags"><span class="tag">Ritmo</span><span class="tag">L√≠nea</span><span class="tag">Proyecci√≥n</span></div>
      </div>
      <div class="feed" id="feedR"></div>
      <div class="swish" id="swishR" aria-hidden="true">üèÄ</div>
    </section>
  </main>

  <footer class="bar bottom">
    <div class="hint">Usa: ?url1=https://‚Ä¶/canal1.json&url2=https://‚Ä¶/canal2.json&interval=15000</div>
  </footer>

  <!-- NO cargamos js/feed.js -->

  <!-- JS inline compatible (ES5) -->
  <script>
  (function(){
    function stamp(){ return (new Date()).toLocaleTimeString(); }
    function fetchJSON(u){
      var url = u + (u.indexOf('?')>=0?'&':'?') + '_=' + Date.now();
      return fetch(url, {cache:'no-store'}).then(function(r){
        if(!r.ok) throw new Error('HTTP '+r.status);
        return r.json();
      });
    }
    function textFrom(data){
      if (typeof data === 'string') return data;
      if (Object.prototype.toString.call(data) === '[object Array]'){
        var last = data[data.length-1] || {};
        return last.text || last.msg || JSON.stringify(last);
      }
      if (data && typeof data === 'object'){
        return data.text || data.msg || JSON.stringify(data);
      }
      return 'Sin datos‚Ä¶';
    }
    function render(targetId, data){
      var el = document.getElementById(targetId);
      if (!el) return;
      el.textContent = textFrom(data);
    }

    var qs = new URLSearchParams(location.search);
    var url1 = qs.get('url1') || 'https://raw.githubusercontent.com/deepsports-insights/deep-sports-live/main/data/canal1.json';
    var url2 = qs.get('url2') || 'https://raw.githubusercontent.com/deepsports-insights/deep-sports-live/main/data/canal2.json';
    var interval = +(qs.get('interval') || 15000);

    function tick(){
      Promise.allSettled([fetchJSON(url1), fetchJSON(url2)]).then(function(res){
        var a = res[0], b = res[1];
        if(a.status==='fulfilled') render('feedL', a.value);
        if(b.status==='fulfilled') render('feedR', b.value);
        document.getElementById('status').textContent = 'OK ‚Ä¢ ' + stamp();
      }).catch(function(e){
        document.getElementById('status').textContent = 'ERR ‚Ä¢ ' + stamp();
        console.error('tick error', e);
      }).then(function(){
        setTimeout(tick, interval);
      });
    }
    tick();
  })();
  </script>
</body>
</html>

